jobs:
  Job1:
    name: Windows VM with RDP & Pinggy
    runs-on: Windows-Server-2022-Medium
    steps:
      - type: powershell
        name: Set Administrator Password
        script: |
          $password = ConvertTo-SecureString "Xy!9#2025_RdpStrong*" -AsPlainText -Force
          Set-LocalUser -Name "Administrator" -Password $password
          Enable-LocalUser -Name "Administrator"
          Write-Host "✅ Administrator password set"

      - type: powershell
        name: Enable RDP
        script: |
          Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          Write-Host "✅ RDP enabled"

      - type: powershell
        name: Run Pinggy Tunnel
        script: |
          $sshPath = "C:\Program Files\Git\usr\bin\ssh.exe"
          Start-Process -NoNewWindow -FilePath $sshPath -ArgumentList "-p 443 -R0:localhost:3389 -o StrictHostKeyChecking=no -o ServerAliveInterval=30 lVuaQjAzw82+tcp@free.pinggy.io"
          Write-Host "✅ Pinggy tunnel started"

      - type: powershell
        name: Keep VM Alive
        script: .\keep-alive.ps1
